<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nakit Akışı 101 - Mobil</title>
    
    <!-- Audio Files -->
    <audio id="background-music" loop preload="auto" volume="0.3">
        <!-- Placeholder for background music - you can replace with actual music file -->
    </audio>
    
    <audio id="dice-sound" preload="auto">
        <!-- Dice roll sound effect -->
    </audio>
    
    <audio id="coin-sound" preload="auto">
        <!-- Coin/money sound effect -->
    </audio>
    
    <audio id="card-sound" preload="auto">
        <!-- Card draw sound effect -->
    </audio>
    
    <audio id="success-sound" preload="auto">
        <!-- Success/positive sound effect -->
    </audio>
    
    <audio id="fail-sound" preload="auto">
        <!-- Fail/negative sound effect -->
    </audio>
    
    <audio id="button-sound" preload="auto">
        <!-- Button click sound effect -->
    </audio>
    <meta name="theme-color" content="#2E7D32">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Nakit Akışı 101">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1B5E20 0%, #2E7D32 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        .mobile-container {
            max-width: 100vw;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: #F1F8E9;
        }

        /* Header */
        .mobile-header {
            background: linear-gradient(135deg, #2E7D32, #4CAF50);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            flex-direction: column;
        }

        .game-title {
            font-size: 1.2em;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        .turn-info {
            font-size: 0.8em;
            opacity: 0.9;
            margin-top: 2px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sound-controls {
            display: flex;
            gap: 5px;
        }

        .sound-btn {
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .sound-btn:active {
            background: rgba(255,255,255,0.3);
            transform: scale(0.95);
        }

        .sound-btn.muted {
            background: rgba(255,0,0,0.3);
            border-color: #ff6b6b;
        }

        .dice-mini {
            width: 35px;
            height: 35px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .dice-mini:active {
            transform: scale(0.95);
        }

        .menu-button {
            width: 35px;
            height: 35px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .menu-button:active {
            background: rgba(255,255,255,0.3);
        }

        /* Main Game Area */
        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* Board Container */
        .board-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }

        .game-board {
            width: min(85vw, 85vh);
            height: min(85vw, 85vh);
            max-width: 400px;
            max-height: 400px;
            background: radial-gradient(circle at center, #FFF8E1 20%, #F0F4C3 80%);
            border: 6px solid #8BC34A;
            border-radius: 50%;
            position: relative;
            box-shadow: 
                inset 0 0 30px rgba(139, 195, 74, 0.3),
                0 0 20px rgba(0,0,0,0.15);
        }

        .board-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30%;
            height: 30%;
            background: linear-gradient(135deg, #FF5722, #FF7043);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 4px 15px rgba(255, 87, 34, 0.4);
        }

        .center-title {
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .center-subtitle {
            font-size: 0.6em;
            opacity: 0.9;
            line-height: 1.2;
        }

        /* Board Spaces */
        .board-space {
            position: absolute;
            width: 50px;
            height: 35px;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.6em;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            border: 2px solid #fff;
        }

        .board-space:active {
            transform: scale(0.95);
        }

        .space-icon {
            font-size: 1em;
            margin-bottom: 2px;
        }

        .space-name {
            font-size: 0.5em;
            font-weight: bold;
            line-height: 1;
        }

        .board-space.paycheck {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
        }

        .board-space.opportunity {
            background: linear-gradient(135deg, #2196F3, #42A5F5);
            color: white;
        }

        .board-space.doodad {
            background: linear-gradient(135deg, #FF9800, #FFB74D);
            color: white;
        }

        .board-space.market {
            background: linear-gradient(135deg, #9C27B0, #BA68C8);
            color: white;
        }

        .board-space.charity {
            background: linear-gradient(135deg, #E91E63, #F06292);
            color: white;
        }

        .board-space.downsized {
            background: linear-gradient(135deg, #F44336, #EF5350);
            color: white;
        }

        /* Player Pieces */
        .player-piece {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: all 0.4s ease;
            z-index: 50;
        }

        .player-piece.current {
            transform: scale(1.4);
            box-shadow: 0 0 15px rgba(255,255,255,0.8);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Bottom Panel */
        .bottom-panel {
            background: white;
            border-top: 3px solid #4CAF50;
            box-shadow: 0 -2px 15px rgba(0,0,0,0.1);
            max-height: 40vh;
            display: flex;
            flex-direction: column;
        }

        /* Player Tabs */
        .player-tabs {
            display: flex;
            background: #F5F5F5;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .player-tabs::-webkit-scrollbar {
            display: none;
        }

        .player-tab {
            padding: 12px 20px;
            background: #E0E0E0;
            border: none;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.3s ease;
            font-size: 0.9em;
            min-width: 100px;
        }

        .player-tab.active {
            background: white;
            color: #4CAF50;
            border-bottom: 3px solid #4CAF50;
        }

        .player-tab.ai {
            background: #E3F2FD;
        }

        .player-tab.ai.active {
            background: white;
            color: #2196F3;
            border-bottom: 3px solid #2196F3;
        }

        /* Player Stats */
        .player-content {
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .player-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .stat-item {
            background: #F8F9FA;
            padding: 8px 6px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #E9ECEF;
        }

        .stat-label {
            font-size: 0.7em;
            color: #666;
            margin-bottom: 3px;
            line-height: 1;
        }

        .stat-value {
            font-weight: bold;
            font-size: 0.8em;
            color: #2E7D32;
            line-height: 1;
        }

        .stat-value.negative {
            color: #D32F2F;
        }

        .escape-status {
            background: #4CAF50;
            color: white;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
            font-size: 0.8em;
            margin-top: 8px;
        }

        /* Action Buttons */
        .action-bar {
            padding: 15px 20px;
            background: #F8F9FA;
            border-top: 1px solid #E0E0E0;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .action-btn {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85em;
            min-width: 80px;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .action-btn:active {
            transform: translateY(1px);
            box-shadow: 0 1px 4px rgba(76, 175, 80, 0.3);
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #FF9800, #FFB74D);
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.3);
        }

        .action-btn.danger {
            background: linear-gradient(135deg, #F44336, #EF5350);
            box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);
        }

        /* Card Modal */
        .card-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            z-index: 1000;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .card-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 90vw;
            width: 350px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translate(-50%, -30%) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .card-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid #E0E0E0;
        }

        .card-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #2E7D32;
            margin-bottom: 5px;
        }

        .card-description {
            font-size: 0.9em;
            color: #666;
            line-height: 1.4;
            margin-bottom: 15px;
        }

        .card-footer {
            display: flex;
            gap: 10px;
        }

        .card-btn {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            font-size: 0.9em;
        }

        .card-btn:active {
            transform: scale(0.98);
        }

        .card-btn.danger {
            background: linear-gradient(135deg, #F44336, #EF5350);
        }

        /* Setup Modal */
        .setup-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .setup-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            max-height: 90vh;
            overflow-y: auto;
        }

        .setup-title {
            font-size: 1.8em;
            color: #2E7D32;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .setup-section {
            margin: 15px 0;
            text-align: left;
        }

        .setup-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }

        .setup-input, .setup-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .setup-input:focus, .setup-select:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .start-btn {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.1em;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .start-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #FFD700, #FFC107);
            color: #333;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.4);
            z-index: 1001;
            animation: notificationSlide 0.4s ease;
            max-width: 90vw;
            text-align: center;
            font-size: 0.9em;
        }

        @keyframes notificationSlide {
            from {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        /* Fast Track Info */
        .fast-track-info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #03A9F4, #29B6F6);
            color: white;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 0.7em;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(3, 169, 244, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fast-track-info:active {
            transform: scale(0.95);
        }

        /* Loading Animation */
        .dice-rolling {
            animation: diceRoll 0.6s ease-in-out;
        }

        @keyframes diceRoll {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(90deg); }
            50% { transform: rotate(180deg); }
            75% { transform: rotate(270deg); }
        }

        /* Responsive adjustments for very small screens */
        @media (max-width: 360px) {
            .game-title {
                font-size: 1em;
            }
            
            .board-space {
                width: 45px;
                height: 32px;
                font-size: 0.55em;
            }
            
            .player-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-btn {
                padding: 10px 12px;
                font-size: 0.8em;
                min-width: 70px;
            }
        }

        /* Dark theme support */
        @media (prefers-color-scheme: dark) {
            .bottom-panel {
                background: #2d2d2d;
                color: #fff;
            }
            
            .player-content {
                background: #2d2d2d;
            }
            
            .stat-item {
                background: #3d3d3d;
                border-color: #4d4d4d;
                color: #fff;
            }
        }
    </style>
</head>
<body>
    <div class="mobile-container">
        <!-- Header -->
        <div class="mobile-header">
            <div class="header-left">
                <div class="game-title">💰 Nakit Akışı 101</div>
                <div class="turn-info">
                    <span id="current-player-name">Oyuncu 1</span> | Tur: <span id="turn-number">1</span>
                </div>
            </div>
            <div class="header-right">
                <div class="sound-controls">
                    <div class="sound-btn" id="music-btn" onclick="toggleMusic()" title="Müzik">🎵</div>
                    <div class="sound-btn" id="sound-btn" onclick="toggleSounds()" title="Ses Efektleri">🔊</div>
                </div>
                <div class="dice-mini" id="dice-mini" onclick="rollDice()">6</div>
                <div class="menu-button" onclick="toggleMenu()">☰</div>
            </div>
        </div>

        <!-- Main Game Area -->
        <div class="game-area">
            <!-- Board Container -->
            <div class="board-container">
                <div class="game-board" id="game-board">
                    <div class="board-center">
                        <div class="center-title">🐭 FARE YARIŞI</div>
                        <div class="center-subtitle">Pasif Gelir > Toplam Gider</div>
                    </div>
                    <!-- Board spaces will be generated here -->
                </div>
                
                <!-- Fast Track Info -->
                <div class="fast-track-info" onclick="showFastTrackInfo()">
                    🚀 HIZLI YOL
                </div>
            </div>

            <!-- Action Bar -->
            <div class="action-bar">
                <button class="action-btn" onclick="playSound('buttonSound'); drawOpportunityCard()">🎴 Fırsat</button>
                <button class="action-btn secondary" onclick="playSound('buttonSound'); drawDoodadCard()">🛍️ Harcama</button>
                <button class="action-btn" onclick="playSound('buttonSound'); payCheck()">💰 Maaş</button>
            </div>
        </div>

        <!-- Bottom Panel -->
        <div class="bottom-panel">
            <!-- Player Tabs -->
            <div class="player-tabs" id="player-tabs">
                <!-- Player tabs will be generated here -->
            </div>

            <!-- Player Content -->
            <div class="player-content" id="player-content">
                <!-- Player stats will be shown here -->
            </div>
        </div>

        <!-- Setup Modal -->
        <div class="setup-modal" id="setup-modal">
            <div class="setup-content">
                <div class="setup-title">🎮 Oyun Kurulumu</div>
                
                <div class="setup-section">
                    <label class="setup-label">Oyuncu Sayısı:</label>
                    <select class="setup-select" id="player-count">
                        <option value="2">2 Oyuncu</option>
                        <option value="3">3 Oyuncu</option>
                        <option value="4" selected>4 Oyuncu</option>
                    </select>
                </div>

                <div class="setup-section">
                    <label class="setup-label">AI Oyuncu Sayısı:</label>
                    <select class="setup-select" id="ai-count">
                        <option value="0">Sadece İnsan Oyuncular</option>
                        <option value="1">1 AI Oyuncu</option>
                        <option value="2">2 AI Oyuncu</option>
                        <option value="3" selected>3 AI Oyuncu</option>
                    </select>
                </div>

                <div class="setup-section">
                    <label class="setup-label">Senin Adın:</label>
                    <input type="text" class="setup-input" id="player-name" value="Oyuncu 1" maxlength="15">
                </div>

                <div class="setup-section">
                    <label class="setup-label">Zorluk Seviyesi:</label>
                    <select class="setup-select" id="difficulty">
                        <option value="easy">Kolay</option>
                        <option value="medium" selected>Orta</option>
                        <option value="hard">Zor</option>
                    </select>
                </div>

                <button class="start-btn" onclick="startGame()">
                    🚀 Oyunu Başlat
                </button>
            </div>
        </div>

        <!-- Card Modal -->
        <div class="card-modal" id="card-modal">
            <div class="card-content">
                <div class="card-header">
                    <div class="card-title" id="card-title">Fırsat Kartı</div>
                </div>
                <div class="card-description" id="card-description">
                    Kart açıklaması buraya gelecek...
                </div>
                <div class="card-footer">
                    <button class="card-btn" onclick="acceptCard()">✅ Kabul Et</button>
                    <button class="card-btn danger" onclick="rejectCard()">❌ Reddet</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Audio Management
        let audioSettings = {
            musicEnabled: true,
            soundEnabled: true,
            musicVolume: 0.3,
            soundVolume: 0.7
        };

        // Audio Elements
        const audioElements = {
            backgroundMusic: document.getElementById('background-music'),
            diceSound: document.getElementById('dice-sound'),
            coinSound: document.getElementById('coin-sound'),
            cardSound: document.getElementById('card-sound'),
            successSound: document.getElementById('success-sound'),
            failSound: document.getElementById('fail-sound'),
            buttonSound: document.getElementById('button-sound')
        };

        // Audio Functions
        function initAudio() {
            // Create simple audio tones using Web Audio API
            createAudioTones();
            
            // Load audio settings from localStorage
            const savedSettings = localStorage.getItem('cashflow-audio-settings');
            if (savedSettings) {
                audioSettings = { ...audioSettings, ...JSON.parse(savedSettings) };
            }
            
            updateAudioButtons();
        }

        function createAudioTones() {
            // Create simple beep sounds using Web Audio API
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Dice roll sound
            createBeepSound(audioElements.diceSound, [400, 600, 800], 0.3);
            
            // Coin sound
            createBeepSound(audioElements.coinSound, [800, 1000, 1200], 0.2);
            
            // Card sound
            createBeepSound(audioElements.cardSound, [300, 400], 0.4);
            
            // Success sound
            createBeepSound(audioElements.successSound, [523, 659, 784], 0.5);
            
            // Fail sound
            createBeepSound(audioElements.failSound, [200, 150, 100], 0.6);
            
            // Button sound
            createBeepSound(audioElements.buttonSound, [600], 0.1);
        }

        function createBeepSound(audioElement, frequencies, duration) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const sampleRate = audioContext.sampleRate;
            const numSamples = sampleRate * duration;
            const buffer = audioContext.createBuffer(1, numSamples, sampleRate);
            const channelData = buffer.getChannelData(0);
            
            for (let i = 0; i < numSamples; i++) {
                let sample = 0;
                frequencies.forEach((freq, index) => {
                    const t = i / sampleRate;
                    const envelope = Math.exp(-t * 3); // Decay envelope
                    sample += Math.sin(2 * Math.PI * freq * t) * envelope * (0.3 / frequencies.length);
                });
                channelData[i] = sample;
            }
            
            const blob = bufferToWave(buffer);
            audioElement.src = URL.createObjectURL(blob);
        }

        function bufferToWave(buffer) {
            const length = buffer.length;
            const arrayBuffer = new ArrayBuffer(44 + length * 2);
            const view = new DataView(arrayBuffer);
            
            // WAV header
            const writeString = (offset, string) => {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            };
            
            writeString(0, 'RIFF');
            view.setUint32(4, 36 + length * 2, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, 1, true);
            view.setUint32(24, buffer.sampleRate, true);
            view.setUint32(28, buffer.sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            writeString(36, 'data');
            view.setUint32(40, length * 2, true);
            
            const channelData = buffer.getChannelData(0);
            let offset = 44;
            for (let i = 0; i < length; i++) {
                const sample = Math.max(-1, Math.min(1, channelData[i]));
                view.setInt16(offset, sample * 0x7FFF, true);
                offset += 2;
            }
            
            return new Blob([arrayBuffer], { type: 'audio/wav' });
        }

        function playSound(soundName) {
            if (!audioSettings.soundEnabled) return;
            
            const audio = audioElements[soundName];
            if (audio) {
                audio.volume = audioSettings.soundVolume;
                audio.currentTime = 0;
                audio.play().catch(e => console.log('Audio play failed:', e));
            }
        }

        function toggleMusic() {
            audioSettings.musicEnabled = !audioSettings.musicEnabled;
            
            if (audioSettings.musicEnabled) {
                // Start background music (placeholder)
                console.log('Background music enabled');
            } else {
                if (audioElements.backgroundMusic) {
                    audioElements.backgroundMusic.pause();
                }
            }
            
            updateAudioButtons();
            saveAudioSettings();
            playSound('buttonSound');
        }

        function toggleSounds() {
            audioSettings.soundEnabled = !audioSettings.soundEnabled;
            updateAudioButtons();
            saveAudioSettings();
            
            if (audioSettings.soundEnabled) {
                playSound('buttonSound');
            }
        }

        function updateAudioButtons() {
            const musicBtn = document.getElementById('music-btn');
            const soundBtn = document.getElementById('sound-btn');
            
            if (musicBtn) {
                musicBtn.textContent = audioSettings.musicEnabled ? '🎵' : '🔇';
                musicBtn.classList.toggle('muted', !audioSettings.musicEnabled);
            }
            
            if (soundBtn) {
                soundBtn.textContent = audioSettings.soundEnabled ? '🔊' : '🔇';
                soundBtn.classList.toggle('muted', !audioSettings.soundEnabled);
            }
        }

        function saveAudioSettings() {
            localStorage.setItem('cashflow-audio-settings', JSON.stringify(audioSettings));
        }

        // Game State
        let gameState = {
            players: [],
            currentPlayerIndex: 0,
            turn: 1,
            gameStarted: false,
            activeCard: null,
            canRollDice: true
        };

        // Player Class
        class Player {
            constructor(name, isAI = false, color = '#F44336') {
                this.name = name;
                this.isAI = isAI;
                this.color = color;
                this.position = 0;
                this.phase = 'rat-race';
                
                // Financial Data
                this.salary = 15000;
                this.savings = 2000;
                this.stocks = 0;
                this.realEstate = 0;
                this.business = 0;
                this.liabilities = 1010000;
                
                // Income & Expenses
                this.interest = 0;
                this.realEstateIncome = 0;
                this.taxes = 2300;
                this.homeMortgage = 2000;
                this.schoolLoans = 300;
                this.carLoans = 600;
                this.creditCards = 450;
                this.otherExpenses = 1500;
                this.childExpenses = 0;
            }

            getTotalIncome() {
                return this.salary + this.interest + this.realEstateIncome;
            }

            getTotalExpenses() {
                return this.taxes + this.homeMortgage + this.schoolLoans + 
                       this.carLoans + this.creditCards + this.otherExpenses + this.childExpenses;
            }

            getPassiveIncome() {
                return this.interest + this.realEstateIncome;
            }

            getCashFlow() {
                return this.getTotalIncome() - this.getTotalExpenses();
            }

            canEscapeRatRace() {
                return this.getPassiveIncome() >= this.getTotalExpenses();
            }

            getNetWorth() {
                const totalAssets = this.savings + this.stocks + this.realEstate + this.business;
                return totalAssets - this.liabilities;
            }
        }

        // AI Strategy
        class AIStrategy {
            static makeDecision(player, card) {
                if (!card || !card.action) return false;

                const cashFlow = player.getCashFlow();
                const canAfford = player.savings >= (card.cost || 0);

                if (!canAfford) return false;

                if (card.type === 'real-estate' || card.type === 'stocks' || card.type === 'business') {
                    const roi = (card.monthlyReturn || 0) / (card.cost || 1);
                    return roi > 0.02;
                }

                if (card.type === 'liability' || card.type === 'expense') {
                    return false;
                }

                return Math.random() > 0.3;
            }
        }

        // Board Spaces Data
        const boardSpaces = [
            { type: 'paycheck', name: 'MAAŞ', icon: '💰' },
            { type: 'opportunity', name: 'FIRSAT', icon: '🎴' },
            { type: 'doodad', name: 'HARCAMA', icon: '🛍️' },
            { type: 'market', name: 'PİYASA', icon: '📈' },
            { type: 'paycheck', name: 'MAAŞ', icon: '💰' },
            { type: 'charity', name: 'HAYIR', icon: '❤️' },
            { type: 'doodad', name: 'HARCAMA', icon: '🛍️' },
            { type: 'opportunity', name: 'FIRSAT', icon: '🎴' },
            { type: 'paycheck', name: 'MAAŞ', icon: '💰' },
            { type: 'downsized', name: 'İŞSİZ', icon: '😢' },
            { type: 'opportunity', name: 'FIRSAT', icon: '🎴' },
            { type: 'market', name: 'PİYASA', icon: '📈' },
            { type: 'paycheck', name: 'MAAŞ', icon: '💰' },
            { type: 'doodad', name: 'HARCAMA', icon: '🛍️' },
            { type: 'opportunity', name: 'FIRSAT', icon: '🎴' },
            { type: 'charity', name: 'HAYIR', icon: '❤️' },
            { type: 'paycheck', name: 'MAAŞ', icon: '💰' },
            { type: 'doodad', name: 'HARCAMA', icon: '🛍️' },
            { type: 'opportunity', name: 'FIRSAT', icon: '🎴' },
            { type: 'market', name: 'PİYASA', icon: '📈' },
            { type: 'paycheck', name: 'MAAŞ', icon: '💰' },
            { type: 'downsized', name: 'İŞSİZ', icon: '😢' },
            { type: 'opportunity', name: 'FIRSAT', icon: '🎴' },
            { type: 'doodad', name: 'HARCAMA', icon: '🛍️' }
        ];

        // Cards Database
        const opportunityCards = [
            {
                title: "4'lü Apartman Dairesi",
                description: "4 daireli apartman binası satın alın. Fiyat: ₺225.000. Aylık nakit akışı: ₺1.000. Peşinat: ₺25.000.",
                type: "real-estate",
                cost: 25000,
                monthlyReturn: 1000,
                totalValue: 225000,
                action: (player) => {
                    if (player.savings >= 25000) {
                        player.savings -= 25000;
                        player.realEstate += 225000;
                        player.realEstateIncome += 1000;
                        return { success: true, message: `${player.name} 4'lü apartman satın aldı!` };
                    }
                    return { success: false, message: `${player.name} yetersiz birikime sahip!` };
                }
            },
            {
                title: "TeknoŞirket Hissesi",
                description: "TeknoŞirket'ten hisse başına ₺50'den 100 hisse satın alın. Temettü: aylık ₺125. Toplam maliyet: ₺5.000.",
                type: "stocks",
                cost: 5000,
                monthlyReturn: 125,
                totalValue: 5000,
                action: (player) => {
                    if (player.savings >= 5000) {
                        player.savings -= 5000;
                        player.stocks += 5000;
                        player.interest += 125;
                        return { success: true, message: `${player.name} TeknoŞirket hissesi satın aldı!` };
                    }
                    return { success: false, message: `${player.name} yetersiz birikime sahip!` };
                }
            },
            {
                title: "Çamaşırhane İşletmesi",
                description: "Çamaşırhane işletmesi satın alın. Fiyat: ₺150.000. Aylık kar: ₺1.500. Peşinat: ₺50.000.",
                type: "business",
                cost: 50000,
                monthlyReturn: 1500,
                totalValue: 150000,
                action: (player) => {
                    if (player.savings >= 50000) {
                        player.savings -= 50000;
                        player.business += 150000;
                        player.realEstateIncome += 1500;
                        return { success: true, message: `${player.name} çamaşırhane işletmesi satın aldı!` };
                    }
                    return { success: false, message: `${player.name} yetersiz birikime sahip!` };
                }
            }
        ];

        const doodadCards = [
            {
                title: "Yeni Araba Alımı",
                description: "Sıfır bir araba satın aldınız! Aylık taksit: ₺2.000. Toplam borç: ₺125.000.",
                type: "liability",
                monthlyExpense: 2000,
                totalLiability: 125000,
                action: (player) => {
                    player.carLoans += 2000;
                    player.liabilities += 125000;
                    return { success: true, message: `${player.name} yeni araba aldı ama borcu arttı!` };
                }
            },
            {
                title: "Kredi Kartı Alışverişi",
                description: "Alışveriş çılgınlığı! Kredi kartı ödemeniz aylık ₺250 arttı.",
                type: "expense",
                monthlyExpense: 250,
                action: (player) => {
                    player.creditCards += 250;
                    player.liabilities += 12500;
                    return { success: true, message: `${player.name} kredi kartı borcunu artırdı!` };
                }
            }
        ];

        // Initialize Game
        function initGame() {
            initAudio();
            generateBoardSpaces();
            showSetupModal();
        }

        function generateBoardSpaces() {
            const board = document.getElementById('game-board');
            
            setTimeout(() => {
                if (!board) return;
                
                const boardRect = board.getBoundingClientRect();
                const radius = Math.min(boardRect.width, boardRect.height) * 0.32;
                const centerX = boardRect.width / 2;
                const centerY = boardRect.height / 2;

                boardSpaces.forEach((space, index) => {
                    const angle = (index / boardSpaces.length) * 2 * Math.PI - Math.PI / 2;
                    const x = centerX + radius * Math.cos(angle) - 25;
                    const y = centerY + radius * Math.sin(angle) - 17.5;

                    const spaceElement = document.createElement('div');
                    spaceElement.className = `board-space ${space.type}`;
                    spaceElement.style.position = 'absolute';
                    spaceElement.style.left = x + 'px';
                    spaceElement.style.top = y + 'px';
                    spaceElement.innerHTML = `
                        <div class="space-icon">${space.icon}</div>
                        <div class="space-name">${space.name}</div>
                    `;
                    spaceElement.onclick = () => handleSpaceClick(index);
                    board.appendChild(spaceElement);
                });
            }, 100);
        }

        function showSetupModal() {
            document.getElementById('setup-modal').style.display = 'flex';
        }

        function startGame() {
            const playerCount = parseInt(document.getElementById('player-count').value);
            const aiCount = parseInt(document.getElementById('ai-count').value);
            const playerName = document.getElementById('player-name').value || 'Oyuncu 1';

            gameState.players = [];
            const colors = ['#F44336', '#2196F3', '#FF9800', '#9C27B0'];
            
            gameState.players.push(new Player(playerName, false, colors[0]));
            
            for (let i = 1; i < playerCount; i++) {
                const isAI = i <= aiCount;
                const name = isAI ? `AI Oyuncu ${i}` : `Oyuncu ${i + 1}`;
                gameState.players.push(new Player(name, isAI, colors[i]));
            }

            document.getElementById('setup-modal').style.display = 'none';
            
            initPlayerTabs();
            updatePlayerDisplay();
            addPlayerPieces();
            
            gameState.gameStarted = true;
            playSound('successSound');
            showNotification('🎮 Oyun başladı! İyi şanslar!');
        }

        function initPlayerTabs() {
            const tabsContainer = document.getElementById('player-tabs');
            tabsContainer.innerHTML = '';

            gameState.players.forEach((player, index) => {
                const tab = document.createElement('button');
                tab.className = `player-tab ${player.isAI ? 'ai' : ''} ${index === 0 ? 'active' : ''}`;
                tab.textContent = player.name;
                tab.onclick = () => switchPlayerTab(index);
                tabsContainer.appendChild(tab);
            });
        }

        function switchPlayerTab(index) {
            document.querySelectorAll('.player-tab').forEach((tab, i) => {
                tab.classList.toggle('active', i === index);
            });
            displayPlayerStats(gameState.players[index]);
        }

        function displayPlayerStats(player) {
            const content = document.getElementById('player-content');
            const totalIncome = player.getTotalIncome();
            const totalExpenses = player.getTotalExpenses();
            const cashFlow = player.getCashFlow();
            const passiveIncome = player.getPassiveIncome();
            const netWorth = player.getNetWorth();

            content.innerHTML = `
                <div class="player-stats">
                    <div class="stat-item">
                        <div class="stat-label">Aşama</div>
                        <div class="stat-value">${player.phase === 'rat-race' ? 'Fare Yarışı' : 'Hızlı Yol'}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Nakit Akışı</div>
                        <div class="stat-value ${cashFlow < 0 ? 'negative' : ''}">${formatCurrency(cashFlow)}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Pasif Gelir</div>
                        <div class="stat-value">${formatCurrency(passiveIncome)}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Birikimler</div>
                        <div class="stat-value">${formatCurrency(player.savings)}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Net Değer</div>
                        <div class="stat-value ${netWorth < 0 ? 'negative' : ''}">${formatCurrency(netWorth)}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Pozisyon</div>
                        <div class="stat-value">${player.position + 1}</div>
                    </div>
                </div>
                ${player.canEscapeRatRace() && player.phase === 'rat-race' ? 
                    '<div class="escape-status">🎉 Fare Yarışından Çıkmaya Hazır!</div>' : 
                    ''}
            `;
        }

        function addPlayerPieces() {
            setTimeout(() => {
                gameState.players.forEach((player, index) => {
                    const piece = document.createElement('div');
                    piece.className = `player-piece`;
                    piece.style.backgroundColor = player.color;
                    piece.id = `player-piece-${index}`;
                    document.getElementById('game-board').appendChild(piece);
                    updatePlayerPosition(index, player.position);
                });
            }, 200);
        }

        function updatePlayerPosition(playerIndex, position) {
            const piece = document.getElementById(`player-piece-${playerIndex}`);
            const spaces = document.querySelectorAll('.board-space');
            
            if (!piece || !spaces[position]) return;
            
            const space = spaces[position];
            const board = document.getElementById('game-board');
            
            if (!board) return;
            
            const boardRect = board.getBoundingClientRect();
            const spaceRect = space.getBoundingClientRect();
            
            const offsetX = (playerIndex % 2) * 12 - 6;
            const offsetY = Math.floor(playerIndex / 2) * 12 - 6;
            
            const relativeX = spaceRect.left - boardRect.left + space.offsetWidth / 2 - 8 + offsetX;
            const relativeY = spaceRect.top - boardRect.top + space.offsetHeight / 2 - 8 + offsetY;
            
            piece.style.position = 'absolute';
            piece.style.left = relativeX + 'px';
            piece.style.top = relativeY + 'px';
        }

        function updatePlayerDisplay() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            document.getElementById('current-player-name').textContent = currentPlayer.name;
            document.getElementById('turn-number').textContent = gameState.turn;
            
            document.querySelectorAll('.player-piece').forEach((piece, index) => {
                piece.classList.toggle('current', index === gameState.currentPlayerIndex);
            });
            
            const activeTabs = document.querySelectorAll('.player-tab.active');
            if (activeTabs.length > 0) {
                const activeIndex = Array.from(document.querySelectorAll('.player-tab')).indexOf(activeTabs[0]);
                displayPlayerStats(gameState.players[activeIndex]);
            }
        }

        function rollDice() {
            if (!gameState.gameStarted || !gameState.canRollDice) return;
            
            playSound('diceSound');
            gameState.canRollDice = false;
            const diceElement = document.getElementById('dice-mini');
            diceElement.classList.add('dice-rolling');
            
            setTimeout(() => {
                const roll = Math.floor(Math.random() * 6) + 1;
                diceElement.textContent = roll;
                diceElement.classList.remove('dice-rolling');
                
                moveCurrentPlayer(roll);
                gameState.canRollDice = true;
            }, 600);
        }

        function moveCurrentPlayer(spaces) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const oldPosition = currentPlayer.position;
            currentPlayer.position = (currentPlayer.position + spaces) % boardSpaces.length;
            
            setTimeout(() => {
                updatePlayerPosition(gameState.currentPlayerIndex, currentPlayer.position);
                
                if (currentPlayer.position < oldPosition || spaces + oldPosition >= boardSpaces.length) {
                    handlePaycheck(currentPlayer);
                } else {
                    setTimeout(() => {
                        handleSpaceAction(currentPlayer, currentPlayer.position);
                    }, 400);
                }
            }, 100);
        }

        function handleSpaceAction(player, position) {
            const space = boardSpaces[position];
            
            switch (space.type) {
                case 'paycheck':
                    handlePaycheck(player);
                    break;
                case 'opportunity':
                    drawOpportunityCard(player);
                    break;
                case 'doodad':
                    drawDoodadCard(player);
                    break;
                case 'market':
                    handleMarket(player);
                    break;
                case 'charity':
                    handleCharity(player);
                    break;
                case 'downsized':
                    handleDownsized(player);
                    break;
            }
        }

        function handleSpaceClick(index) {
            showNotification(`${boardSpaces[index].name} alanı: ${boardSpaces[index].icon}`);
        }

        function handlePaycheck(player) {
            const cashFlow = player.getCashFlow();
            player.savings += cashFlow;
            playSound('coinSound');
            showNotification(`💰 ${player.name} maaş aldı: ${formatCurrency(cashFlow)}`);
            
            if (player.canEscapeRatRace() && player.phase === 'rat-race') {
                player.phase = 'fast-track';
                playSound('successSound');
                showNotification(`🎉 ${player.name} Fare Yarışından kaçtı!`);
            }
            
            updatePlayerDisplay();
            nextTurn();
        }

        function drawOpportunityCard(player = null) {
            if (!player) player = gameState.players[gameState.currentPlayerIndex];
            const card = opportunityCards[Math.floor(Math.random() * opportunityCards.length)];
            showCard(card, player);
        }

        function drawDoodadCard(player = null) {
            if (!player) player = gameState.players[gameState.currentPlayerIndex];
            const card = doodadCards[Math.floor(Math.random() * doodadCards.length)];
            showCard(card, player);
        }

        function handleMarket(player) {
            showNotification(`📈 ${player.name} piyasa değişikliği yaşadı!`);
            nextTurn();
        }

        function handleCharity(player) {
            const donation = Math.min(player.savings * 0.1, player.getTotalExpenses());
            player.savings -= donation;
            showNotification(`❤️ ${player.name} hayır işine ${formatCurrency(donation)} bağışladı!`);
            nextTurn();
        }

        function handleDownsized(player) {
            const penalty = player.getTotalExpenses() * 2;
            player.savings -= penalty;
            playSound('failSound');
            showNotification(`😢 ${player.name} işsiz kaldı! ${formatCurrency(penalty)} kayıp!`);
            nextTurn();
        }

        function payCheck() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            handlePaycheck(currentPlayer);
        }

        function showCard(card, player) {
            playSound('cardSound');
            gameState.activeCard = { card, player };
            document.getElementById('card-title').textContent = card.title;
            document.getElementById('card-description').textContent = card.description;
            document.getElementById('card-modal').style.display = 'block';
            
            if (player.isAI) {
                setTimeout(() => {
                    const decision = AIStrategy.makeDecision(player, card);
                    if (decision) {
                        acceptCard();
                    } else {
                        rejectCard();
                    }
                }, 2000);
            }
        }

        function acceptCard() {
            if (gameState.activeCard) {
                const { card, player } = gameState.activeCard;
                const result = card.action(player);
                if (result.success) {
                    playSound('successSound');
                } else {
                    playSound('failSound');
                }
                showNotification(result.message);
                updatePlayerDisplay();
            }
            closeCard();
        }

        function rejectCard() {
            playSound('buttonSound');
            if (gameState.activeCard) {
                const { player } = gameState.activeCard;
                showNotification(`${player.name} kartı reddetti.`);
            }
            closeCard();
        }

        function closeCard() {
            document.getElementById('card-modal').style.display = 'none';
            gameState.activeCard = null;
            nextTurn();
        }

        function nextTurn() {
            gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
            
            if (gameState.currentPlayerIndex === 0) {
                gameState.turn++;
            }
            
            updatePlayerDisplay();
            
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            if (currentPlayer.isAI && gameState.gameStarted) {
                setTimeout(() => {
                    rollDice();
                }, 1500);
            }
        }

        function formatCurrency(amount) {
            return '₺' + amount.toLocaleString('tr-TR');
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        function toggleMenu() {
            // Menu functionality can be added here
            showNotification('📋 Menü özelliği yakında eklenecek!');
        }

        function showFastTrackInfo() {
            showNotification('🚀 Hızlı Yol: Fare Yarışından kaçtıktan sonra büyük fırsatlar sizi bekliyor!');
        }

        // Initialize game on load
        window.addEventListener('load', initGame);

        // Close modal when clicking outside
        document.getElementById('card-modal').addEventListener('click', (e) => {
            if (e.target.id === 'card-modal') {
                rejectCard();
            }
        });

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
